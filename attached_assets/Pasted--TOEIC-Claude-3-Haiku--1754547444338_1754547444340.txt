まだ中学英語なのに、TOEICの問題が出題される問題が続いている。

#### ① カテゴリに応じた適切な問題を出題すること

* Claude 3 Haiku に渡すプロンプトに**カテゴリ情報を明示的に含めること**。
* 各カテゴリごとに以下のように**プロンプトの内容を切り替える**こと。

```ts
// 例（擬似コード）
const promptMap = {
  junior_high: `中学英語レベルの簡単な文法と単語（be動詞, 一般動詞, 三単現, 疑問文, 否定文など）を使った短文を出題してください。`,
  senior_high: `高校英語レベルの構文（仮定法, 分詞構文, 関係代名詞, 接続詞）を使った文を出題してください。`,
  toeic: `TOEICに頻出する単語や表現（例：negotiate, schedule, due to, in accordance with）を含む例文を出題してください。`,
  basic_verbs: `have, get, move, eat, make, go などの基本動詞を使った日常的な例文を出題してください。`,
  business_email: `会議・スケジュール調整・商談・契約・転職活動・議事録などビジネスシーンで使う英語表現を含んだ英文を出題してください。`,
};
```

* UIで選択したカテゴリ（`categoryId` または `mode` など）を必ずバックエンド・出題ロジックに渡すようにしてください。

---

#### ② 同じ問題を繰り返し出題しないこと

* **セッション単位で出題履歴を保存**し、同じ英作文問題が出ないようにしてください。
* Claudeへのプロンプトに「これまでと重複しない問題を出題してください」と追加してください。

  * 例：

    ```
    直前に出題された内容と重複しないようにしてください。同じ文型・単語・シチュエーションの繰り返しは避けてください。
    ```

---

#### ③ 中学英語カテゴリのレベル制限

* 中学英語カテゴリでは、次の条件を守ってください：

  * 主語 + be動詞
  * 主語 + 一般動詞（過去形も含むが不規則動詞の使用は最小限に）
  * 疑問文・否定文は中学1〜3年で学ぶ範囲まで
  * 例：

    * He plays soccer every day.
    * Do you like pizza?
    * I didn’t go to school yesterday.

---

#### ④ 高校英語カテゴリのレベル制限

* 高校英語カテゴリでは、次のような内容を含めてください：
 
 * 基本的に高校1年〜3年まで学ぶ範囲まで
  * 仮定法（If I were you, ...）
  * 関係詞（who, which, that）
  * 分詞構文（Given the situation, ...）
  * 長めの複文（2節以上）
  * 難単語の使用は適度に（大学受験レベル）
  * 例：

    * The man who is talking to Mary is my teacher.
    * If I had studied harder, I could have passed the exam.

---

#### ⑤ 基本動詞カテゴリの制限

* `have`, `get`, `make`, `go`, `come`, `eat`, `move`, `take`, `give`, `put` など基本動詞を中心に出題。
* 難解な句動詞や複雑な時制は避け、以下のような例をベースにしてください。

  * 例：

    * I got a new phone last week.
    * She made a cake for her friend.
    * They go to school by bike.

---

#### ⑥ ビジネスメールカテゴリの出題内容

* 次のような**業務シーンを想定した英作文**を出題するようにプロンプトを調整：

  * 会議の依頼・スケジュール調整
  * アポイントのキャンセル・再調整
  * 契約書の送付・確認依頼
  * 面接日程の連絡・転職活動のフォロー
  * 議事録の送付・依頼
  * 英語のビジネスメールで頻出する語彙（e.g., confirm, schedule, follow up, contract, client, interview, arrange, etc.）を含める

---

### 🔚 備考

* 修正後は、**各カテゴリで出題される初回と2問目の内容が同一カテゴリに沿っているか確認**してください。
* Fly.io 本番環境でも動作確認を必ず実施すること。
